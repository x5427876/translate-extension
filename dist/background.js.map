{"version":3,"file":"background.js","mappings":";;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AENA;AACA;AACA;AACA","sources":["webpack://nineyi-translate-extension/./src/background/background.ts","webpack://nineyi-translate-extension/./src/background/eventhandler.ts","webpack://nineyi-translate-extension/./src/staticData.ts","webpack://nineyi-translate-extension/webpack/bootstrap","webpack://nineyi-translate-extension/webpack/runtime/define property getters","webpack://nineyi-translate-extension/webpack/runtime/hasOwnProperty shorthand","webpack://nineyi-translate-extension/webpack/runtime/make namespace object","webpack://nineyi-translate-extension/webpack/before-startup","webpack://nineyi-translate-extension/webpack/startup","webpack://nineyi-translate-extension/webpack/after-startup"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { setChromeListener } from './eventhandler';\nimport { LANGUAGE_TOOL_API_KEY } from '../staticData';\n// 開始執行所有事件監聽\nsetChromeListener();\nconst getUserGoogleInfoByToken = (idToken) => __awaiter(void 0, void 0, void 0, function* () {\n    let response = yield fetch(`https://www.googleapis.com/identitytoolkit/v3/relyingparty/getAccountInfo?key=${LANGUAGE_TOOL_API_KEY}`, {\n        method: 'POST',\n        body: JSON.stringify({ idToken: idToken })\n    });\n    let jsonObj = yield response.json();\n    // 儲存使用者資訊\n    yield chrome.storage.sync.set({\n        displayName: jsonObj.users[0].displayName,\n        email: jsonObj.users[0].email,\n        photoUrl: jsonObj.users[0].photoUrl\n    });\n    chrome.runtime.sendMessage({ action: \"setReactUserInfo\" });\n});\n// 取得使用者資訊後關閉 LT tab\nconst closeLanguageToolTab = (tableId) => {\n    if (tableId != 0) {\n        chrome.tabs.remove(tableId, function () {\n            tableId = 0;\n        });\n    }\n};\nexport { getUserGoogleInfoByToken, closeLanguageToolTab };\n","import { getUserGoogleInfoByToken, closeLanguageToolTab } from './background';\nimport { LANGUAGE_TOOL_URL } from '../staticData';\nlet tabToClose = 0;\nlet idToken;\nlet pageLang = 'zh-TW';\nconst setChromeListener = () => {\n    // 點擊登入按鈕\n    chrome.runtime.onMessage.addListener((request) => {\n        if (request.action === \"openLanguageToolTab\") {\n            // 開啟新分頁讓使用者登入 Language Tool\n            chrome.tabs.create({\n                url: LANGUAGE_TOOL_URL,\n                active: false\n            }, (tab) => {\n                // 儲存 tabId 以便在取得到用戶資訊後可關閉指定 tab\n                tabToClose = tab.id;\n            });\n        }\n    });\n    // 攔截 LT 發送的 POST 請求，並提取其中的 idToken\n    chrome.webRequest.onBeforeRequest.addListener(function (details) {\n        if (details.method == 'POST'\n            && details.initiator == LANGUAGE_TOOL_URL\n            && details.requestBody != undefined\n            && details.requestBody.raw != undefined) {\n            // 解析請求 Body 中的資料\n            let postedString = decodeURIComponent(String.fromCharCode.apply(null, \n            // @ts-ignore\n            new Uint8Array(details.requestBody.raw[0].bytes)));\n            // Get the token then start to get user informaions and info dev panel to retry patch action\n            if (postedString.includes('idToken')) {\n                let postJsonObj = JSON.parse(postedString);\n                if (postJsonObj.idToken.length >= 100) {\n                    idToken = postJsonObj.idToken;\n                    chrome.storage.sync.set({ token: postJsonObj.idToken }, function () {\n                        getUserGoogleInfoByToken(idToken);\n                        closeLanguageToolTab(tabToClose);\n                        chrome.runtime.sendMessage({ action: ['autoRetryPatchAfterAutoGetToken'] });\n                    });\n                }\n            }\n        }\n    }, { urls: ['<all_urls>'] }, ['requestBody']);\n};\nexport { setChromeListener };\n","// 可使用小工具 Domain\nexport const LANGUAGE_TOOL_API_KEY = 'AIzaSyDKyl5i5uLG_vFBF2cxdJwfzkXNdQuNn80';\nexport const LANGUAGE_TOOL_URL = 'https://translation.qa.91dev.tw';\nexport const VALID_DOMAIN_LIST = [\n    'sms.qa.91dev.tw',\n    'sms.qa8.91dev.tw',\n];\nexport const LANGUAGE_SELECT_DATA = [\n    { value: 'zh-TW', name: \"中文\" },\n    { value: 'zh-HK', name: \"香港中文\" },\n    { value: 'en-US', name: \"英文\" },\n    { value: 'ms-MY', name: \"馬來文\" },\n    { value: 'kok-IN', name: \"火星文\" }\n];\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(\"./src/background/background.ts\");\n",""],"names":[],"sourceRoot":""}